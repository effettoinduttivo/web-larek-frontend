# Проектная работа “Web-ларёк”
## Описание проекта 
Веб-ларек — это интернет-магазин товаров для разработчиков, выполненный с использованием TypeScript и принципов объектно-ориентированного программирования.

Основная функциональность позволяет:
- просмотреть каталог товаров
- при нажатии на карточку товара открыть детальный просмотр 
- добавить товар в корзину или удалить его из корзины
- оформить заказ на выбранные товары, указав данные для доставки

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ — файлы с повторяющимися компонентами отображения 
- src/components/view/ — компоненты отображения

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс модели данных приложения 

```
interface IAppState {
	catalog: IProduct[];
	basket: IProduct[] | null;
	order: IOrder | null;
	preview: string | null;
}
```

Данные о товаре, получаемые с сервера 

```
interface IProduct {
	id: string;
	description?: string;
	image?: string;
	title: string;
	category?: TCategory;
	price: number | null;
}
```

Интерфейс данных в форме для выбора способа оплаты и указания адреса 

```
interface IOrderAddressForm {
	payment: TPaymentMethod;
	address: string;
}
```

Интерфейс данных в форме для указания контактов 

```
interface IOrderContactsForm {
	email: string;
	phone: string;
}
```

Интерфейс заказа, объединяющий данные форм и информацию о заказе 

```
interface IOrder extends IOrderAddressForm, IOrderContactsForm {
	items: string[];
	total: number;
}
```

Данные, приходящие с сервера при успешном заказе

```
interface IOrderResult {
	id: string;
	total: number;
}
```

Категории товаров

```
type TCategory = 'хард-скил' | 'софт-скил' | 'кнопка' | 'дополнительное' | 'другое'
```

Методы отплаты

```
type TPaymentMethod = 'card' | 'cash' | ''
```

Ошибки валидации

```
type TFormErrors = Partial<Record<keyof IOrder, string>>
```


## Архитектура приложения

Приложение написано с использованием MVP-архитектуры, выделены 3 слоя: 
- слой данных — отвечает за хранение данных и действия с ними 
- слой представления отображает данные на странице
- презентер связывает данные и отображение

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` — выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` — принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` — подписка на событие
- `emit` — инициализация события
- `trigger` — возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие  


### Слой данных

#### Базовый класс Model 
Абстрактный базовый класс для создания моделей данных в приложении. Принимает в конструктор начальные данные для инициализации модели и брокер событий для обработки изменений данных. Содержит метод `emitChanges(event: string, payload?: object)` для вызова события при изменении модели.

#### Класс AppState
Класс отвечает за хранение и логику работы с данными всего приложения.
В полях класса хранятся следующие данные:
- catalog: IProduct[] — массив объектов товаров каталога
-	basket: IProduct[] — массив товаров, добавленных в корзину
-	order: IOrder — данные о заказе
-	preview: string | null — id выбранного для открытия в модальном окне товара
-	formErrors: TFormErrors — объект ошибок валидации полей заказа 

Для взаимодействия с данными используются следующие методы:
- setCatalog(products: IProduct[]): void — устанавливает значение поля catalog, вызывает событие изменения карточек 
- setProductPreview(product: IProduct): void — устанавливает id переданной карточки в preview, вызывает событие открытия модального окна товара 
- toggleBasketStatus(product: IProduct): void — изменяет статус товара в корзине на противоположный 
- getBasketTotal(): number — считает сумму товаров в корзине 
- clearBasket(): void — очищает корзину и данные заказа, вызывает обновление отображения, связанного с корзиной 
- setOrderDetails(field: keyof IOrderAddressForm, value: string): void — сохраняет данные о способе оплате заказа и адресе 
- setContacts(field: keyof IOrderContactsForm, value: string): void — сохраняет email и телефон 
- validateAddress(): boolean — проверяет выбор способа оплаты и адрес на валидность  
- validateContacts(): boolean — проверяет контактные данные на валидность


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Реализует модальные окна и устанавливает в них содержимое. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(container: HTMLElement, events: IEvents) Конструктор принимает родительский контейнер и экземпляр класса `EventEmitter` для возможности инициации событий.

Содержит сеттер:
- content: HTMLElement — содержимое модального окна

#### Класс Form
Базовый класс для всех форм в приложении. Содержит метод `onInputChange(field: keyof T, value: string)`, который вызывает событие изменения данных при вводе. Также класс содержит сеттеры для валидности формы (определяет состояние кнопки сабмита) и для ошибок валидации.

#### Класс Page
Отвечает за отображение главной страницы. Конструктор принимает родительский контейнер(document.body) и экземпляр `EventEmitter` для инициации событий. Поля класса содержат элементы разметки страницы, также устанавливается слушатель на кнопку корзины.
В классе используются сеттеры для отображения каталога товаров, установки данных в счётчик корзины и для переключения блокировки скролла страницы (например, при открытии модального окна) 

#### Класс Product
Базовый класс для работы с карточками товаров. Отвечает за отображение и управление базовыми элементами карточки: названием и ценой. Конструктор принимает контейнер для размещения элементов карточки.

Геттеры и сеттеры:
- id: string — получение и установка идентификатора товара
- title: string — получение и установка названия товара
- price: number | null — установка цены товара (null — “Бесценно”)

#### Класс ProductBasket
Расширяет базовый класс Product для отображения товаров в корзине. Добавляет функционал отображения порядкового номера и кнопки удаления товара из корзины. Конструктор принимает контейнер, порядковый номер и функцию для кнопки удаления. Используется сеттер для установки порядкового номера товара.

#### Класс ProductCatalog
Расширяет Product для отображения карточек товаров в каталоге. Добавляет изображения и категории товаров. Конструктор принимает контейнер и функцию-коллбэк, которая вызывается при клике на карточку.

Геттеры и сеттеры:
- image: string — установка URL изображения и альтернативного текста 
- category: string — установка категории товара, добавление нужного класса для стилизации 

#### Класс ProductPreview
Расширяет ProductCatalog для отображения подробной информации карточки товара с описанием и кнопкой покупки. Конструктор принимает контейнер и функцию-коллбэк для кнопки покупки товара.

Геттеры, сеттеры и методы:
- description: string — установка описания товара
- buyButtonText: string — установка текста на кнопке покупки
- price: number | null — переопределенный сеттер цены, который дополнительно блокирует кнопку покупки, если у товара нет цены 
- checkPriceless(value: number | null) — приватный метод для проверки на “бесценность” и блокировки кнопки покупки при отсутствии цены

#### Класс Basket
Отвечает за отображение корзины. Поля класса содержат список товаров в корзине, элемент с суммой заказа и кнопку подтвержения заказа и перехода к его оформлению. На кнопку устанавливается слушатель, вызывающий событие открытия формы заказа.

Сеттеры:
- items: HTMLElement[] — установка списка товаров, добавленных в корзину (если товаров нет, в корзине появляется надпись об этом и блокируется кнопка)
- total: number — установка текста с суммой товаров

#### Класс OrderAddressForm
Наследует базовый класс Form для реализации формы выбора адреса доставки и способа оплаты. Поля класса содержат инпут для ввода адреса доставки и кнопки для выбора способа оплаты “онлайн” — `card` и “при получении” — `cash`.

Сеттеры и методы:
- address: string — установка адреса доставки
- pickPayment(method: TPaymentMethod): void — приватный метод для выбора способа оплаты. Переключает CSS-класс `button_alt-active` для визуального выделения выбранного метода и вызывает событие изменения способа оплаты

#### Класс OrderContactsForm
Наследует базовый класс Form для реализации формы с указанием почты и номера телефона. Поля класса содержат соответствующие инпуты, также класс содержит сеттеры для установки почты и телефона.

#### Класс OrderSuccess
Наследует класс Component и реализует экран успешного формирования заказа. Поля класса содержат id оформленного заказа, элемент с суммой заказа и дополнительную кнопку закрытия модального окна, на которую устанавливается обработчик клика.

Геттеры и сеттеры:
- id: string — установка и получение id заказа
- total: number — устанавливает текст с суммой заказа


### Слой коммуникации

#### Класс WebLarekAPI
Наследуется от базового класса Api и отвечает за взаимодействие с сервером.

Использует следующие методы:
- getProductList: () => Promise<IProduct[]> — получение списка товаров 
- getProduct: (id: string) => Promise<IProduct> — получение одного товара по его id 
- orderProducts: (order: IOrder) => Promise<IOrderResult> — отправляет заказ со всеми контактными данными на сервер 

## Взаимодействие компонентов
Роль презентера выполняет файл `index.ts` — он связывает между собой слой данных и их отображение.\
В проекте используется событийно-ориентированный подход, то есть взаимодействие осуществляется за счёт событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

#### Список всех событий, которые могут генерироваться в системе:

*События изменения данных*
- `items:change` — изменение массива товаров
- `item:select` — выбор товара для детального просмотра 
- `basket:update` — изменение данных корзины

*События, возникающие при взаимодействии пользователя с интерфейсом*
- `preview:open` — открытие карточки товара
- `basket:open` — открытие корзины
- `order:open` — открытие окна с формой для указания адреса и способа оплаты
- `modal:open` — открытие модального окна
- `modal:close` — закрытие модального окна
- события изменения ввода в формах
- `addressFormErrors:change` — изменение ошибок валидации при вводе данных в форме с адресом и способом оплаты
- `contactsFormErrors:change` — изменение ошибок валидации при вводе данных в форме с почтой и телефоном
- `order:submit` — сохранение данных способа оплаты и адреса и открытие формы с контактами
- `contacts:submit` — сохранение данных заказа и открытие окна успешной оплаты
